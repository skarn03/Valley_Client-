"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[84],{7348:function(e,n,t){var r=t(4165),s=t(5861),a=t(9439),i=t(2791);n.Z=function(){var e=(0,i.useState)(!1),n=(0,a.Z)(e,2),t=n[0],c=n[1],o=(0,i.useState)(null),u=(0,a.Z)(o,2),l=u[0],f=u[1],d=(0,i.useRef)([]),h=(0,i.useCallback)(function(){var e=(0,s.Z)((0,r.Z)().mark((function e(n){var t,s,a,i,o,u,l,h=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>1&&void 0!==h[1]?h[1]:"GET",s=h.length>2&&void 0!==h[2]?h[2]:null,a=h.length>3&&void 0!==h[3]?h[3]:{},c(!0),f(null),i=new AbortController,d.current.push(i),e.prev=7,e.next=10,fetch(n,{method:t,body:s,headers:a,signal:i.signal});case 10:return o=e.sent,e.next=13,o.json();case 13:if(u=e.sent,d.current=d.current.filter((function(e){return e!==i})),o.ok){e.next=19;break}throw(l=new Error(u.message||"Request failed")).response=u,l;case 19:return c(!1),e.abrupt("return",u);case 23:throw e.prev=23,e.t0=e.catch(7),c(!1),f(e.t0),e.t0;case 28:case"end":return e.stop()}}),e,null,[[7,23]])})));return function(n){return e.apply(this,arguments)}}(),[]);return(0,i.useEffect)((function(){return function(){d.current.forEach((function(e){return e.abort()}))}}),[]),{isLoading:t,error:l,sendRequest:h,onCloseError:function(){f(null)}}}},8084:function(e,n,t){t.r(n),t.d(n,{default:function(){return p}});var r=t(4165),s=t(5861),a=t(9439),i=t(2791),c=t(7348),o=t(6852),u=t(3433),l=t(7689),f=t(1006),d=t(184),h=function(e){var n=e.user,t=e.onClose,h=(0,i.useState)([]),p=(0,a.Z)(h,2),m=p[0],v=p[1],x=(0,i.useState)(""),g=(0,a.Z)(x,2),j=g[0],C=g[1],k=(0,l.s0)(),N=(0,i.useContext)(o.V),Z=(0,i.useRef)(null),E=(0,c.Z)().sendRequest,_=(0,i.useState)([]),S=(0,a.Z)(_,2),w=S[0],T=S[1],y=(0,i.useState)(null),b=(0,a.Z)(y,2),R=b[0],A=b[1];(0,i.useEffect)((function(){var e=(0,f.io)({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_BACKEND_URL:"http://localhost:5000/api"}.REACT_APP_BACKEND_SOCKET);return A(e),e.on("receiveMessage",(function(e){v((function(n){return[].concat((0,u.Z)(n),[e])}))})),function(){e.disconnect()}}),[]),(0,i.useEffect)((function(){var e=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E("http://localhost:5000/api"+"/conversation/get/".concat(n._id),"GET",null,{"Content-Type":"application/json",Authorization:"Bearer "+N.token});case 3:return t=e.sent,T(t),e.abrupt("return",t._id);case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(n){var t,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n){e.next=7;break}return e.next=4,E("http://localhost:5000/api"+"/message/get/".concat(n),"GET",null,{"Content-Type":"application/json",Authorization:"Bearer "+N.token});case 4:t=e.sent,s=t.map((function(e){return{key:e._id,sender:e.sender,text:e.text,id:e._id}})),v(s);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(n){return e.apply(this,arguments)}}();e().then((function(e){t(e)}))}),[n,E,N.token]),(0,i.useEffect)((function(){return R&&w._id&&R.emit("joinRoom",w._id),R&&R.on("newMessageNotification",(function(){console.log("has sent you a new message")})),function(){R&&R.off("newMessageNotification")}}),[R,w]);var D=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===j.trim()){e.next=13;break}return console.log(n),e.prev=2,R.emit("sendMessage",{roomID:w._id,message:{sender:N.userID,text:j},recipientID:n._id}),e.next=6,E("http://localhost:5000/api/message/create","POST",JSON.stringify({conversationID:w._id,sender:N.userID,text:j}),{"Content-Type":"application/json",Authorization:"Bearer "+N.token});case 6:e.sent,C(""),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}();return(0,i.useEffect)((function(){Z.current.scrollTop=Z.current.scrollHeight}),[m]),w&&(0,d.jsxs)("div",{className:"mini-chat-box",children:[(0,d.jsxs)("div",{className:"mini-chat-header",children:[(0,d.jsx)("img",{className:"mini-chat-avatar",src:n.profilePic,alt:n.name}),(0,d.jsx)("button",{className:"profile-clicker",children:(0,d.jsx)("span",{onClick:function(){k("/profile/"+n._id)},className:"mini-chat-name",children:n.name})}),(0,d.jsx)("button",{className:"mini-chat-close",onClick:function(){t()},children:(0,d.jsx)("i",{className:"fas fa-times"})})]}),(0,d.jsx)("hr",{}),(0,d.jsxs)("div",{className:"headinput",children:[(0,d.jsx)("div",{className:"mini-chat-content",ref:Z,children:m.length>0&&m.map((function(e){return(0,d.jsx)("div",{id:e.sender==N.userID?"you":"other",className:"mini-chat-message",children:(0,d.jsx)("span",{children:e.text})},e.id)}))}),(0,d.jsxs)("div",{className:"mini-chat-input",children:[(0,d.jsx)("input",{type:"text",placeholder:"Type your message...",value:j,onChange:function(e){C(e.target.value)},onKeyDown:function(e){13===e.keyCode&&D()}}),(0,d.jsx)("button",{className:"mini-chat-send",onClick:D,children:"Send"})]})]})]})},p=function(){var e=(0,i.useState)([]),n=(0,a.Z)(e,2),t=n[0],u=n[1],l=(0,i.useState)(""),f=(0,a.Z)(l,2),p=f[0],m=f[1],v=(0,c.Z)().sendRequest,x=(0,i.useContext)(o.V),g=(0,i.useState)(null),j=(0,a.Z)(g,2),C=j[0],k=j[1];(0,i.useEffect)((function(){var e=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v("http://localhost:5000/api/users/friends","GET",null,{"Content-Type":"application/json",Authorization:"Bearer "+x.token});case 3:n=e.sent,u(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e()}),[x.token,v]);var N=t.filter((function(e){return e.name.toLowerCase().includes(p.toLowerCase())}));return(0,d.jsxs)("div",{className:"messenger-container",children:[(0,d.jsx)("h2",{className:"messenger-title",children:"Friends"}),(0,d.jsx)("div",{className:"search-container",children:(0,d.jsx)("input",{type:"text",placeholder:"Search",value:p,onChange:function(e){m(e.target.value)},className:"search-input"})}),(0,d.jsx)("ul",{className:"messenger-friends-list",children:N.map((function(e){return(0,d.jsxs)("li",{id:"lister",className:"messenger-friend-item ".concat(e.online?"messenger-online":"messenger-offline"),title:e.online?"Online":"Offline",onClick:function(){k(e)},children:[(0,d.jsx)("div",{className:"messenger-friend-avatar",children:(0,d.jsx)("img",{src:e.profilePic,alt:e.name})}),(0,d.jsxs)("div",{className:"messenger-friend-info",children:[(0,d.jsx)("div",{className:"messenger-friend-name",children:e.name}),(0,d.jsx)("div",{id:"status",className:"messenger-friend-status",children:e.online?"Online":"Offline"})]})]},e.id)}))}),C&&(0,d.jsx)(h,{user:C,onClose:function(){k(null)}})]})}}}]);
//# sourceMappingURL=84.71f0a37b.chunk.js.map